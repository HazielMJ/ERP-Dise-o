<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ERP - Control de Usuarios</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  body { margin:0; font-family:'Segoe UI', sans-serif; background:#f4f6f9; }
  header {
    background:#0066cc; color:white; padding:15px 30px;
    display:flex; justify-content:space-between; align-items:center;
  }
  header h1 { margin:0; font-size:22px; }
  header a { color:white; text-decoration:none; }

  .container { padding:30px; }
  h2 { color:#0066cc; }

  table {
    width:100%; border-collapse:collapse; margin-top:20px;
    background:white; border-radius:8px; overflow:hidden;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
  }
  th, td {
    padding:12px; text-align:left; border-bottom:1px solid #ddd;
  }
  th { background:#0066cc; color:white; }
  tr:hover { background:#f1f1f1; }

  .btn {
    padding:8px 12px; border:none; border-radius:6px;
    cursor:pointer; font-size:14px; transition:0.3s;
  }
  .btn-add { background:#28a745; color:white; margin-bottom:15px; }
  .btn-edit { background:#ffc107; color:black; }
  .btn-del { background:#dc3545; color:white; }
  .btn:hover { opacity:0.8; }

  /* Modal */
  .modal {
    display:none; position:fixed; z-index:1000; left:0; top:0;
    width:100%; height:100%; background:rgba(0,0,0,0.6);
    justify-content:center; align-items:center;
  }
  .modal-content {
    background:white; padding:20px; border-radius:10px;
    width:90%; max-width:400px; animation:fadeIn 0.3s ease;
  }
  .modal-content h3 { margin-top:0; color:#0066cc; }
  .modal-content input, .modal-content select {
    width:100%; padding:10px; margin:8px 0;
    border:1px solid #ccc; border-radius:6px;
  }
  .close { float:right; font-size:20px; cursor:pointer; color:red; }
  .error { color:red; font-size:13px; margin-top:-5px; margin-bottom:10px; }
  @keyframes fadeIn { from{opacity:0; transform:scale(0.8);} to{opacity:1; transform:scale(1);} }
</style>
</head>
<body>

<header>
  <h1><i class="fas fa-users-cog"></i> Control de Usuarios</h1>
  <a href="index.html"><i class="fas fa-home"></i> Volver al Dashboard</a>
</header>

<div class="container">
  <h2>Usuarios</h2>
  <button class="btn btn-add" onclick="openModal()">+ Nuevo Usuario</button>

  <table id="tablaUsuarios">
    <thead>
      <tr>
        <th>ID</th><th>Nombre</th><th>Correo</th><th>Rol</th><th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>


<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h3 id="modalTitle">Agregar Usuario</h3>
    <input type="hidden" id="editIndex">
    <input type="text" id="nombre" placeholder="Nombre completo" required>
    <div id="errorNombre" class="error"></div>
    <input type="email" id="correo" placeholder="Correo electrónico" required>
    <div id="errorCorreo" class="error"></div>
    <select id="rol" required>
      <option value="">-- Selecciona un rol --</option>
      <option value="Jefe">Jefe</option>
      <option value="Administrador">Administrador</option>
      <option value="Empleado">Empleado</option>
      <option value="Supervisor">Supervisor</option>
    </select>
    <div id="errorRol" class="error"></div>
    <button class="btn btn-add" onclick="guardarUsuario()">Guardar</button>
  </div>
</div>

<script>
let usuarios = [
  {id:1, nombre:"Xiomara Pineda Jimenez", correo:"xiomara@gmail.com", rol:"Administrador"},
  {id:2, nombre:"Carlos López", correo:"carlos@gmail.com", rol:"Empleado"}
];
let editando = false;


function renderTabla(){
  const tbody = document.querySelector("#tablaUsuarios tbody");
  tbody.innerHTML = "";
  usuarios.forEach((u,index)=>{
    tbody.innerHTML += `
      <tr>
        <td>${u.id}</td>
        <td>${u.nombre}</td>
        <td>${u.correo}</td>
        <td>${u.rol}</td>
        <td>
          <button class="btn btn-edit" onclick="editarUsuario(${index})">Editar</button>
          <button class="btn btn-del" onclick="eliminarUsuario(${index})">Eliminar</button>
        </td>
      </tr>
    `;
  });
}


function openModal(){
  document.getElementById("modal").style.display="flex";
  document.getElementById("modalTitle").innerText="Agregar Usuario";
  document.getElementById("editIndex").value="";
  document.getElementById("nombre").value="";
  document.getElementById("correo").value="";
  document.getElementById("rol").value="";
  limpiarErrores();
  editando = false;
}


function closeModal(){
  document.getElementById("modal").style.display="none";
}


function limpiarErrores(){
  document.getElementById("errorNombre").innerText="";
  document.getElementById("errorCorreo").innerText="";
  document.getElementById("errorRol").innerText="";
}


function validarFormulario(nombre, correo, rol){
  let valido = true;
  limpiarErrores();

  if(!/^[a-zA-ZÁÉÍÓÚÑáéíóúñ\s]{3,50}$/.test(nombre)){
    document.getElementById("errorNombre").innerText="El nombre debe tener al menos 3 letras y solo contener caracteres válidos.";
    valido = false;
  }
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(correo)){
    document.getElementById("errorCorreo").innerText="Ingrese un correo electrónico válido.";
    valido = false;
  }
  if(rol===""){
    document.getElementById("errorRol").innerText="Debe seleccionar un rol.";
    valido = false;
  }
  return valido;
}


function guardarUsuario(){
  const nombre = document.getElementById("nombre").value.trim();
  const correo = document.getElementById("correo").value.trim();
  const rol = document.getElementById("rol").value;

  if(!validarFormulario(nombre, correo, rol)) return;

  if(editando){
    const i = document.getElementById("editIndex").value;
    usuarios[i].nombre = nombre;
    usuarios[i].correo = correo;
    usuarios[i].rol = rol;
  } else {
    const id = usuarios.length ? usuarios[usuarios.length-1].id+1 : 1;
    usuarios.push({id, nombre, correo, rol});
  }

  renderTabla();
  closeModal();
}


function editarUsuario(index){
  editando = true;
  document.getElementById("modal").style.display="flex";
  document.getElementById("modalTitle").innerText="Editar Usuario";
  document.getElementById("editIndex").value=index;
  document.getElementById("nombre").value=usuarios[index].nombre;
  document.getElementById("correo").value=usuarios[index].correo;
  document.getElementById("rol").value=usuarios[index].rol;
  limpiarErrores();
}


function eliminarUsuario(index){
  if(confirm("¿Seguro que quieres eliminar este usuario?")){
    usuarios.splice(index,1);
    renderTabla();
  }
}


window.onclick = function(e){
  const modal = document.getElementById("modal");
  if(e.target==modal){ closeModal(); }
};

renderTabla();
</script>

</body>
</html>
