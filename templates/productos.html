<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema ERP - Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/Estilodash.css">
<style>
    /*
 * ===========================================
 * ESTILOS PARA EL MODAL (Formulario emergente)
 * =p=========================================
 */

/* 1. El fondo oscuro que cubre la pantalla */
.modal {
    display: none; /* Oculto por defecto */
    position: fixed; /* Se queda fijo en la pantalla */
    z-index: 1000; /* Se pone encima de todo */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto; /* Permite scroll si el contenido es muy grande */
    background-color: rgba(0, 0, 0, 0.5); /* Fondo negro semi-transparente */
    
    /* Para centrar el contenido */
    align-items: center;
    justify-content: center;
}

/* 2. Clase que el JavaScript a√±ade para MOSTRAR el modal */
.modal.active {
    display: flex; /* Cambia a 'flex' para mostrarlo y centrarlo */
}

/* 3. El contenedor blanco del formulario (la "tarjeta") */
.modal-content {
    background-color: var(--blanco-fondo);
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    width: 90%;
    max-width: 700px; /* Ancho m√°ximo del formulario */
    margin: auto;
    animation: fadeInModal 0.3s ease;
    
    /* Ajuste para que no se desborde en m√≥vil */
    max-height: 90vh;
    display: flex;
    flex-direction: column;
}

/* 4. Estilos para el encabezado del modal */
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 24px;
    border-bottom: 1px solid var(--gris-suave);
}

.modal-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--gris-texto);
    margin: 0;
}

/* 5. Bot√≥n de cerrar (la 'X') */
.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #888;
    cursor: pointer;
    padding: 0;
    line-height: 1;
}
.modal-close:hover {
    color: #333;
}

/* 6. Cuerpo del modal (donde va el formulario) */
.modal-body {
    padding: 24px;
    overflow-y: auto; /* Permite scroll si el formulario es largo */
}

/* 7. Pie del modal (donde van los botones de Guardar/Cancelar) */
.modal-footer {
    display: flex;
    justify-content: flex-end; /* Alinea botones a la derecha */
    gap: 12px;
    padding: 16px 24px;
    background-color: var(--gris-suave-2);
    border-top: 1px solid var(--gris-suave);
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
}

/* Animaci√≥n simple de aparici√≥n */
@keyframes fadeInModal {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-chart-line"></i> ERP System</h2>
                <p>Sistema Integral de Gesti√≥n</p>
            </div>
            <ul class="nav-menu">
                <li class="nav-section">
                    <div class="nav-section-title">PRINCIPAL</div>
                </li>
                <li class="nav-item">
                    <a href="/" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                
                <li class="nav-section">
                    <div class="nav-section-title">ADMINISTRACI√ìN</div>
                </li>
                <li class="nav-item">
                    <a class="nav-link">
                        <i class="fas fa-user-shield"></i>
                        <span>Usuarios</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link">
                        <i class="fas fa-calculator"></i>
                        <span>Contabilidad</span>
                    </a>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">VENTAS</div>
                </li>
                <li class="nav-item">
                    <a href="/Clientes" class="nav-link">
                        <i class="fas fa-users"></i>
                        <span>Clientes</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/ventas" class="nav-link">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Ventas</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/facturacion" class="nav-link">
                        <i class="fas fa-file-invoice"></i>
                        <span>Facturaci√≥n</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/caja" class="nav-link">
                        <i class="fas fa-cash-register"></i>
                        <span>Punto de Venta</span>
                    </a>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">COMPRAS</div>
                </li>
                <li class="nav-item">
                    <a class="nav-link">
                        <i class="fas fa-truck"></i>
                        <span>Proveedores</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link">
                        <i class="fa-sharp fa-solid fa-bag-shopping"></i>
                        <span>Compras</span>
                    </a>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">INVENTARIO</div>
                </li>
                <li class="nav-item">
                    <a href="/productos" class="nav-link active">
                        <i class="fas fa-boxes"></i>
                        <span>Inventario</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/almacen " class="nav-link">
                        <i class="fas fa-warehouse"></i>
                        <span>Almacenes</span>
                    </a>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">RECURSOS HUMANOS</div>
                </li>
                <li class="nav-item">
                    <a href="/empleados" class="nav-link">
                        <i class="fas fa-user-tie"></i>
                        <span>Empleados</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/nomina" class="nav-link">
                        <i class="fa-sharp fa-solid fa-money-bill-wave"></i>
                        <span>N√≥mina</span>
                    </a>
                </li>
                <li class="nav-section">
                    <div class="nav-section-title">LOG√çSTICA</div>
                </li>
                <li class="nav-item">
                    <a href="/logistica" class="nav-link">
                        <i class="fa-sharp fa-solid fa-truck-fast"></i>
                        <span>Env√≠os</span>
                    </a>
                </li>

                <li class="nav-section">
                    <div class="nav-section-title">AN√ÅLISIS</div>
                </li>
                <li class="nav-item">
                    <a class="nav-link">
                        <i class="fa-sharp fa-solid fa-gear"></i>
                        <span>Reportes</span>
                    </a>
                </li>
                                <li class="nav-section">
                    <div class="nav-section-title">SISTEMA</div>
                </li>
                <li class="nav-item">
                    <a class="nav-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>Configuraci√≥n</span>
                    </a>
                </li>
            </ul>
            <!-- Bot√≥n de cerrar sesi√≥n -->
            <div class="logout-section">
                <button class="btn-logout" onclick="cerrarSesion()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Cerrar Sesi√≥n</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div>
                        <h1><i class="fas fa-tachometer-alt"></i> Inventario</h1>
                        <div class="breadcrumb">
                            <a href="/"><i class="fas fa-home"></i> Inicio</a>
                            <span>/</span>
                            <span>Inventario</span>
                        </div>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="header-btn" style="position: relative;">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                    <button class="header-btn">
                        <i class="fas fa-envelope"></i>
                    </button>
                    <div class="user-info">
                        <div class="user-avatar">AD</div>
                        <div>
                            <div style="font-weight: 700; color: var(--gris-texto); font-size: 14px;">
                                <span class="status-indicator status-online"></span>Admin
                            </div>
                            <div style="font-size: 12px; color: var(--gris-texto-secundario);">Administrador</div>
                        </div>
                    </div>
                </div>
            </header>

<section class="content-section">
            <div class="toolbar-actions">
                <button id="abrirProductoBtn" class="btn btn-primary">
                    <i class="fa-solid fa-plus"></i>
                    <span class="btn-label">Nuevo Producto</span>
                </button>
            </div>

            <div class="table-container" style="margin-top:20px;">
                <div class="table-header">
                    <div class="table-title">
                        <i class="fas fa-list"></i> Productos
                    </div>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>C√≥digo</th>
                            <th>Nombre</th>
                            <th>Compra</th>
                            <th>Venta</th>
                            <th>Stock (min/max)</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaProductos"></tbody>
                </table>
            </div>
        </section>
    </main>
    <div id="productoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-box"></i>
                    <span id="productoFormTitulo">Agregar Producto</span>
                </h3>
                <button type="button" class="modal-close" id="cerrarProductoBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <div id="productoAlerta" class="alert-box alert-warning" style="display:none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span id="productoAlertaMsg">Completa los campos obligatorios.</span>
                </div>

                <form id="formProducto">
                    <input type="hidden" id="idProducto"/>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="codigoProducto" class="form-label">C√≥digo <span class="required">*</span></label>
                            <input type="text" id="codigoProducto" class="form-input" placeholder="Ej. PRD-001" required/>
                        </div>

                        <div class="form-group">
                            <label for="nombreProducto" class="form-label">Nombre <span class="required">*</span></label>
                            <input type="text" id="nombreProducto" class="form-input" placeholder="Nombre del producto" required/>
                        </div>

                        <div class="form-group">
                            <label for="precioCompra" class="form-label">Precio compra</label>
                            <input type="number" id="precioCompra" class="form-input" step="0.01" min="0" placeholder="0.00"/>
                        </div>

                        <div class="form-group">
                            <label for="precioVenta" class="form-label">Precio venta</label>
                            <input type="number" id="precioVenta" class="form-input" step="0.01" min="0" placeholder="0.00"/>
                        </div>

                        <div class="form-group">
                            <label for="stockMinimo" class="form-label">Stock m√≠nimo</label>
                            <input type="number" id="stockMinimo" class="form-input" min="0" placeholder="0"/>
                        </div>

                        <div class="form-group">
                            <label for="stockMaximo" class="form-label">Stock m√°ximo</label>
                            <input type="number" id="stockMaximo" class="form-input" min="0" placeholder="0"/>
                        </div>

                        <div class="form-group full-width">
                            <label for="descripcion" class="form-label">Descripci√≥n</label>
                            <textarea id="descripcion" class="form-textarea" rows="3" placeholder="Descripci√≥n general..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="estado" class="form-label">Estado</label>
                            <select id="estado" class="form-select">
                                <option value="ACTIVO">ACTIVO</option>
                                <option value="INACTIVO">INACTIVO</option>
                                <option value="DESCONTINUADO">DESCONTINUADO</option>
                            </select>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Guardar
                        </button>
                        <button type="button" id="cancelarProductoBtn" class="btn btn-secondary">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

<script>
    // ===============================================
    // FUNCIONES GLOBALES DEL ERP
    // ===============================================

    /** Toggle sidebar en m√≥vil */
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        if (sidebar) {
            sidebar.classList.toggle('active');
        }
    }

    /** Funci√≥n de cerrar sesi√≥n */
    function cerrarSesion() {
        if (confirm('¬øEst√° seguro que desea cerrar sesi√≥n?')) {
            showNotification('Cerrando sesi√≥n...', 'info');
            setTimeout(() => {
                showNotification('Sesi√≥n cerrada exitosamente. ¬°Hasta pronto!', 'success');
                // Aqu√≠ puedes redirigir a la p√°gina de login
                // window.location.href = '/login';
            }, 1000);
        }
    }

    /** Sistema de notificaciones (Versi√≥n √∫nica y global) */
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        let bgColor = 'var(--azul-principal)';
        let icon = 'fa-info-circle';
        
        if (type === 'success') {
            bgColor = 'var(--verde-exito)';
            icon = 'fa-check-circle';
        } else if (type === 'error') {
            bgColor = 'var(--rojo-peligro)';
            icon = 'fa-exclamation-circle';
        } else if (type === 'warning') {
            bgColor = 'var(--amarillo-advertencia)';
            icon = 'fa-exclamation-triangle';
        }
        
        notification.style.cssText = `
            position: fixed; top: 20px; right: 20px; background: ${bgColor};
            color: ${type === 'warning' ? 'var(--gris-texto)' : 'white'};
            padding: 18px 24px; border-radius: 12px; box-shadow: 0 6px 25px rgba(0,0,0,0.3);
            z-index: 10000; animation: slideIn 0.4s ease; max-width: 350px;
            white-space: pre-line; display: flex; align-items: center;
            gap: 12px; font-weight: 500;
        `;
        
        notification.innerHTML = `
            <i class="fas ${icon}" style="font-size: 20px;"></i>
            <span>${message}</span>
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'fadeOut 0.4s ease';
            setTimeout(() => notification.remove(), 400);
        }, 3500);
    }

        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.animation = `fadeIn 0.5s ease ${index * 0.1}s forwards`;
            card.style.opacity = '0';
        });

        // Notificaci√≥n de bienvenida
        setTimeout(() => {
            showNotification('¬°Bienvenido al Sistema ERP! üöÄ', 'success');
        }, 800);

        // Cerrar sidebar al hacer clic en cualquier parte en m√≥vil
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const menuBtn = document.querySelector('.mobile-menu-btn');
            if (window.innerWidth <= 768) {
                // Asegurarse que los elementos existen antes de leer 'contains'
                if (sidebar && menuBtn && !sidebar.contains(e.target) && !menuBtn.contains(e.target)) {
                    sidebar.classList.remove('active');
                }
            }
        });

        // Log de informaci√≥n
        console.log('%cüöÄ Sistema ERP Dashboard', 'color: #4a90e2; font-size: 20px; font-weight: bold;');
        console.log('%c‚ú® Sistema cargado exitosamente', 'color: #28a745; font-size: 14px;');

        
        document.addEventListener('DOMContentLoaded', () => {
    const API_URL = 'http://localhost:8082/api/productos'; 

    // Referencias UI
    const modal = document.getElementById('productoModal');
    const abrirBtn = document.getElementById('abrirProductoBtn');
    const cerrarBtn = document.getElementById('cerrarProductoBtn');
    const cancelarBtn = document.getElementById('cancelarProductoBtn');
    const titulo = document.getElementById('productoFormTitulo');
    const alerta = document.getElementById('productoAlerta');
    const alertaMsg = document.getElementById('productoAlertaMsg');
    const form = document.getElementById('formProducto');
    const tbody = document.getElementById('tablaProductos');

    // Campos
    const idInput = document.getElementById('idProducto');
    const codigoInput = document.getElementById('codigoProducto');
    const nombreInput = document.getElementById('nombreProducto');
    const compraInput = document.getElementById('precioCompra');
    const ventaInput = document.getElementById('precioVenta');
    const stockMinInput = document.getElementById('stockMinimo');
    const stockMaxInput = document.getElementById('stockMaximo');
    const descInput = document.getElementById('descripcion');
    const estadoSelect = document.getElementById('estado');

    if (!modal || !abrirBtn || !form || !tbody) {
        console.warn('M√≥dulo de Productos no cargado. Faltan elementos HTML clave.');
        return; 
    }
    
    console.log('%cüì¶ M√≥dulo de Productos inicializado.', 'color: #28a745;');

    // Helpers
    const fmt = n => '$' + Number(n ?? 0).toFixed(2);

    function showAlerta(msg, type='warning') {
        alerta.classList.remove('alert-info','alert-success','alert-warning','alert-danger');
        alerta.classList.add(`alert-${type}`);
        alertaMsg.textContent = msg;
        alerta.style.display = 'flex';
    }
    function hideAlerta(){ alerta.style.display = 'none'; }

    // Modal handlers
    function abrirModalParaAlta() {
        form.reset();
        idInput.value = '';
        titulo.textContent = 'Agregar Producto';
        estadoSelect.value = 'ACTIVO'; 
        hideAlerta();
        modal.classList.add('active');
    }
    function cerrarModal() {
        modal.classList.remove('active');
    }

    abrirBtn.addEventListener('click', abrirModalParaAlta);
    cerrarBtn.addEventListener('click', cerrarModal);
    cancelarBtn.addEventListener('click', cerrarModal);
    modal.addEventListener('click', (e)=>{ if(e.target === modal) cerrarModal(); });

    // Render
    function badgeEstado(est){
        if (est === 'ACTIVO') return '<span class="badge badge-success">ACTIVO</span>';
        if (est === 'INACTIVO') return '<span class="badge badge-danger">INACTIVO</span>';
        return '<span class="badge badge-secondary">DESCONTINUADO</span>';
    }
    
    // --- 1. ARREGLO EN "filaProductoHTML" (Leer snake_case) ---
    function filaProductoHTML(p){
        return `
            <tr data-id="${p.id_producto}">
                <td>${p.id_producto}</td>
                <td>${p.codigo_producto}</td>
                <td>${p.nombre_producto}</td>
                <td>${fmt(p.precio_compra)}</td>
                <td>${fmt(p.precio_venta)}</td>
                <td>${p.stock_minimo ?? 0}/${p.stock_maximo ?? 0}</td>
                <td>${badgeEstado(p.estado)}</td>
                <td>
                    <button type="button" class="btn btn-sm btn-secondary" data-action="edit">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button type="button" class="btn btn-sm btn-danger" data-action="del">
                        <i class="fas fa-trash"></i> Eliminar
                    </button>
                </td>
            </tr>
        `;
    }

    async function cargarProductos(){
        try{
            const res = await fetch(API_URL);
            if (!res.ok) throw new Error(`Error ${res.status}: No se pudo conectar a la API.`);
            const data = await res.json();
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="empty-state"><i class="fas fa-box-open"></i><h3>No hay productos</h3><p>Crea el primer producto para empezar.</p></td></tr>';
                return;
            }
            tbody.innerHTML = data.map(filaProductoHTML).join('');
        }catch(err){
            showNotification(`No se pudieron cargar los productos.\n${err.message}`, 'error');
            tbody.innerHTML = `<tr><td colspan="8" class="empty-state alert-danger"><i class="fas fa-exclamation-triangle"></i><h3>Error al cargar</h3><p>${err.message}</p></td></tr>`;
            console.error(err);
        }
    }

    // Validaci√≥n
    function validar(){
        const errores = [];
        if(!codigoInput.value.trim()) errores.push('El c√≥digo es obligatorio.');
        if(!nombreInput.value.trim()) errores.push('El nombre es obligatorio.');
        const pc = compraInput.value.trim()===''?null:Number(compraInput.value);
        const pv = ventaInput.value.trim()===''?null:Number(ventaInput.value);
        const smin = stockMinInput.value.trim()===''?null:Number(stockMinInput.value);
        const smax = stockMaxInput.value.trim()===''?null:Number(stockMaxInput.value);
        if(pc!==null && (isNaN(pc)||pc<0)) errores.push('Precio compra inv√°lido.');
        if(pv!==null && (isNaN(pv)||pv<0)) errores.push('Precio venta inv√°lido.');
        if(smin!==null && (isNaN(smin)||smin<0)) errores.push('Stock m√≠nimo inv√°lido.');
        if(smax!==null && (isNaN(smax)||smax<0)) errores.push('Stock m√°ximo inv√°lido.');
        if(smin!==null && smax!==null && smin > smax) errores.push('Stock m√≠nimo no puede exceder al m√°ximo.');
        
        if(errores.length){ 
            showAlerta(errores.join('\n'),'warning'); 
            return false; 
        }
        hideAlerta(); 
        return true;
    }

    // --- 2. ARREGLO EN "Guardar / actualizar" (Enviar snake_case) ---
    form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        if(!validar()) return;

        // El payload debe usar snake_case para coincidir con la regla de Spring
        const payload = {
            codigo_producto: codigoInput.value.trim(),
            nombre_producto: nombreInput.value.trim(),
            precio_compra: compraInput.value.trim()===''? null : Number(compraInput.value),
            precio_venta:  ventaInput.value.trim()===''? ¬†null : Number(ventaInput.value),
            stock_minimo:  stockMinInput.value.trim()===''? null : Number(stockMinInput.value),
            stock_maximo:  stockMaxInput.value.trim()===''? null : Number(stockMaxInput.value),
            descripcion: ¬† descInput.value.trim(),
            estado: ¬† ¬† ¬†  estadoSelect.value
        };

        const id = idInput.value;
        const method = id ? 'PUT' : 'POST';
        const url = id ? `${API_URL}/${id}` : API_URL;

        try{
            const res = await fetch(url, {
                method,
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify(payload)
            });
            if(!res.ok) {
                // Capturamos el error real del backend
                const errorMsg = await res.text();
                throw new Error(errorMsg || `Error ${res.status}`);
            }
            
            showNotification('Producto guardado correctamente.', 'success');
            await cargarProductos();
            cerrarModal();
        }catch(err){
            console.error(err);
            // Mostramos el error real
            showAlerta(`No se pudo guardar el producto. Error: ${err.message}`, 'danger');
        }
    });

    // --- 3. ARREGLO EN "Delegaci√≥n para Editar" (Leer snake_case) ---
    tbody.addEventListener('click', async (e)=>{
        const btn = e.target.closest('button[data-action]');
        if(!btn) return;
        const tr = btn.closest('tr');
        const id = tr?.dataset?.id;
        if(!id) return;

        if(btn.dataset.action === 'edit'){
            try{
                const res = await fetch(`${API_URL}/${id}`);
                if(!res.ok) throw new Error("No se pudo cargar la info de la API");
                
                const p = await res.json(); // p = { "id_producto": 1, "nombre_producto": ... }

                // Leemos snake_case del JSON que env√≠a el backend
                idInput.value = p.id_producto ?? '';
                codigoInput.value = p.codigo_producto ?? '';
                nombreInput.value = p.nombre_producto ?? '';
                compraInput.value = p.precio_compra ?? '';
                ventaInput.value  = p.precio_venta  ?? '';
                stockMinInput.value = p.stock_minimo ?? '';
                stockMaxInput.value = p.stock_maximo ?? '';
                descInput.value = p.descripcion ?? '';
                estadoSelect.value = p.estado ?? 'ACTIVO';
                
                titulo.textContent = 'Editar Producto';
                hideAlerta();
                modal.classList.add('active');
            }catch(err){
                console.error(err);
                showNotification('No se pudo cargar el producto para editar.', 'danger');
            }
        }

        if(btn.dataset.action === 'del'){
            if(!confirm('¬øEst√° seguro de eliminar este producto?')) return;
            try{
                const res = await fetch(`${API_URL}/${id}`, {method:'DELETE'});
                if(!res.ok) {
                     const errorMsg = await res.text();
                    throw new Error(errorMsg || `Error ${res.status}`);
                }
                await cargarProductos();
                showNotification('Producto eliminado.', 'success');
            }catch(err){
                console.error(err);
                showNotification(`No se pudo eliminar el producto. Error: ${err.message}`, 'danger');
            }
        }
    });

    // Inicial
    cargarProductos();

});
    </script>
</body>
</html>
