<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ERP Contabilidad & Facturaci√≥n</title>
  <style>
    :root {
      --bg: #f3f6fb;
      --sidebar: #2460a7;
      --sidebar-hover: #1a4f8b;
      --text: #2d3436;
      --text-light: #666;
      --card-bg: #ffffff;
      --accent: #2563eb;
      --accent-hover: #1e4ed8;
      --ok: #22c55e;
      --warn: #f59e0b;
      --err: #ef4444;
      --br: 12px;
      --shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      --transition: 0.25s ease;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
    }

    /* SIDEBAR */
    .sidebar {
      width: 250px;
      background: var(--sidebar);
      color: #fff;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      display: flex;
      flex-direction: column;
      padding: 25px 15px;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.15);
    }

    .sidebar h2 {
      font-size: 24px;
      text-align: center;
      margin-bottom: 40px;
      letter-spacing: 1px;
    }

    .sidebar nav {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .sidebar a {
      text-decoration: none;
      color: #fff;
      padding: 12px 15px;
      border-radius: var(--br);
      font-weight: 500;
      transition: background var(--transition);
    }

    .sidebar a:hover,
    .sidebar a.active {
      background: var(--sidebar-hover);
    }

    /* MAIN */
    .main {
      margin-left: 260px;
      padding: 35px;
      flex: 1;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* CARD */
    .card {
      background: var(--card-bg);
      border-radius: var(--br);
      box-shadow: var(--shadow);
      padding: 25px 30px;
      margin-bottom: 30px;
      border: 1px solid #e3e3e3;
      transition: transform var(--transition);
    }

    .card:hover {
      transform: translateY(-3px);
    }

    .card h2,
    .card h3 {
      color: var(--accent);
      margin-top: 0;
      border-bottom: 2px solid var(--accent);
      padding-bottom: 8px;
      margin-bottom: 20px;
    }

    /* FORMULARIO */
    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 20px;
    }

    label {
      font-weight: 600;
      font-size: 14px;
      color: var(--text);
      margin-bottom: 4px;
      display: block;
    }

    input,
    select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ccc;
      border-radius: var(--br);
      font-size: 14px;
      background-color: #fff;
      transition: var(--transition);
    }

    input:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
      outline: none;
    }

    button {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 10px 18px;
      border-radius: var(--br);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }

    button:hover {
      background: var(--accent-hover);
    }

    .btn-toggle {
      background: transparent;
      color: var(--accent);
      border: 2px solid var(--accent);
      padding: 8px 14px;
      border-radius: var(--br);
      margin-bottom: 15px;
      font-weight: 600;
    }

    .btn-toggle:hover {
      background: var(--accent);
      color: #fff;
    }

    /* TABLA */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 14px;
      border-radius: var(--br);
      overflow: hidden;
    }

    th {
      background: var(--accent);
      color: white;
      padding: 12px;
    }

    td {
      background: white;
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #eee;
    }

    tr:hover td {
      background: #f8fafc;
    }

    .btn-accion {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 13px;
      color: #fff;
      text-decoration: none;
      font-weight: 500;
      margin: 0 3px;
      transition: var(--transition);
    }

    .btn-editar {
      background: var(--warn);
    }

    .btn-editar:hover {
      background: #d97706;
    }

    .btn-eliminar {
      background: var(--err);
    }

    .btn-eliminar:hover {
      background: #b91c1c;
    }

    .error,
    .alerta-error {
      grid-column: 1 / -1;
      text-align: center;
      padding: 10px;
      border-radius: var(--br);
      font-weight: 600;
    }

    .alerta-error {
      background-color: #ffe4e4;
      color: #b91c1c;
      border: 1px solid #fca5a5;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 200px;
      }
      .main {
        margin-left: 210px;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>ERP</h2>
    <nav>
      <a href="#" class="active" onclick="mostrarSeccion('contabilidad', this)">üìä Contabilidad</a>
      <a href="#" onclick="mostrarSeccion('facturacion', this)">üßæ Facturaci√≥n</a>
    </nav>
  </div>

  <div class="main">
    <!-- üîπ CONTABILIDAD -->
    <section id="contabilidad" class="seccion">
      <div class="card">
        <h2>Contabilidad</h2>
        <div th:if="${param.error}" class="alerta-error">
          <span th:if="${param.error[0] == 'camposVacios'}">‚ùå No puedes dejar campos vac√≠os</span>
          <span th:if="${param.error[0] == 'duplicado'}">‚ö†Ô∏è Ese n√∫mero ya existe, no puedes duplicarlo</span>
        </div>

        <button type="button" class="btn-toggle" onclick="toggleFormulario('formContabilidad')">
          Mostrar / Ocultar Formulario
        </button>

        <form id="formContabilidad" th:action="@{/contabilidad/guardar}" th:object="${contabilidad}" method="post" class="hidden">
          <label for="fecha_asiento">Fecha Asiento</label>
          <input type="date" id="fecha_asiento" th:field="*{fecha_asiento}" required />

          <label for="numero_asiento">N√∫mero Asiento</label>
          <input type="text" id="numero_asiento" th:field="*{numero_asiento}" required />

          <label for="descripcion">Descripci√≥n</label>
          <input type="text" id="descripcion" th:field="*{descripcion}" required />

          <label for="estado">Estado</label>
          <select id="estado" th:field="*{estado}" required>
            <option value="">-- Selecciona estado --</option>
            <option value="Pendiente">Pendiente</option>
            <option value="Aprobado">Aprobado</option>
            <option value="Cerrado">Cerrado</option>
            <option value="Cancelado">Cancelado</option>
          </select>

          <label for="id_usuario">ID Usuario</label>
          <input type="text" id="id_usuario" th:field="*{id_usuario}" required />

          <label for="total_debe">Total Debe</label>
          <input type="number" step="0.01" id="total_debe" th:field="*{total_debe}" required />

          <label for="total_haber">Total Haber</label>
          <input type="number" step="0.01" id="total_haber" th:field="*{total_haber}" required />

          <label for="periodo_contable">Periodo Contable</label>
          <input type="text" id="periodo_contable" th:field="*{periodo_contable}" required />

          <label for="fecha_contabilizacion">Fecha Contabilizaci√≥n</label>
          <input type="date" id="fecha_contabilizacion" th:field="*{fecha_contabilizacion}" required />

          <button type="submit" style="grid-column: 1 / -1;">üíæ Guardar Asiento</button>
        </form>
      </div>

      <div class="card">
        <h3>üìã Lista de Asientos</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Fecha</th>
              <th>N√∫mero</th>
              <th>Descripci√≥n</th>
              <th>Estado</th>
              <th>ID Usuario</th>
              <th>Total Debe</th>
              <th>Total Haber</th>
              <th>Periodo</th>
              <th>Fecha Contabilizaci√≥n</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="c : ${contabilidades}">
              <td th:text="${c.id_asiento}"></td>
              <td th:text="${c.fecha_asiento}"></td>
              <td th:text="${c.numero_asiento}"></td>
              <td th:text="${c.descripcion}"></td>
              <td th:text="${c.estado}"></td>
              <td th:text="${c.id_usuario}"></td>
              <td th:text="${c.total_debe}"></td>
              <td th:text="${c.total_haber}"></td>
              <td th:text="${c.periodo_contable}"></td>
              <td th:text="${c.fecha_contabilizacion}"></td>
              <td>
                <a th:href="@{'/contabilidad/editar/' + ${c.id_asiento}}" class="btn-accion btn-editar">‚úèÔ∏è</a>
                <a th:href="@{'/contabilidad/eliminar/' + ${c.id_asiento}}" class="btn-accion btn-eliminar" onclick="return confirm('¬øSeguro que deseas eliminar este registro?')">üóëÔ∏è</a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- üîπ FACTURACI√ìN -->
    <section id="facturacion" class="seccion hidden">
      <div class="card">
        <h2>Facturaci√≥n</h2>
        <div th:if="${param.error}" class="alerta-error">
          <span th:if="${param.error[0] == 'camposVacios'}">‚ùå No puedes dejar campos vac√≠os</span>
          <span th:if="${param.error[0] == 'duplicado'}">‚ö†Ô∏è Ese n√∫mero ya existe</span>
        </div>

        <button class="btn-toggle" onclick="toggleFormulario('formFacturacion')">
          Mostrar / Ocultar Formulario
        </button>

        <form id="formFacturacion" th:action="@{/facturacion/guardar}" th:object="${factura}" method="post" class="hidden">
          <label for="numero_factura">N√∫mero Factura</label>
          <input type="text" id="numero_factura" th:field="*{numero_factura}" required />

          <label for="fecha_emision">Fecha de Emisi√≥n</label>
          <input type="date" id="fecha_emision" th:field="*{fecha_emision}" required />

          <label for="fecha_vencimiento">Fecha de Vencimiento</label>
          <input type="date" id="fecha_vencimiento" th:field="*{fecha_vencimiento}" required />

          <label for="id_cliente">ID Cliente</label>
          <input type="text" id="id_cliente" th:field="*{id_cliente}" required />

          <label for="id_venta">ID Venta</label>
          <input type="text" id="id_venta" th:field="*{id_venta}" required />

          <label for="subtotal">Subtotal</label>
          <input type="number" step="0.01" id="subtotal" th:field="*{subtotal}" required />

          <label for="impuestos">Impuestos (%)</label>
          <input type="number" step="0.01" id="impuestos" th:field="*{impuestos}" required />

          <label for="descuentos">Descuento (%)</label>
          <input type="number" step="0.01" id="descuentos" th:field="*{descuentos}" required />

          <label for="total">Total</label>
          <input type="number" step="0.01" id="total" th:field="*{total}" readonly required />

          <label for="estado">Estado</label>
          <select id="estado" th:field="*{estado}" required>
            <option value="">-- Selecciona estado --</option>
            <option value="Pagada">Pagada</option>
            <option value="Pendiente">Pendiente</option>
            <option value="Vencida">Vencida</option>
          </select>

          <label for="tipo_factura">Tipo de Factura</label>
          <select id="tipo_factura" th:field="*{tipo_factura}" required>
            <option value="">-- Tipo de factura --</option>
            <option value="Venta">Venta</option>
            <option value="Compra">Compra</option>
            <option value="Servicio">Servicio</option>
          </select>

          <label for="forma_pago">Forma de Pago</label>
          <select id="forma_pago" th:field="*{forma_pago}" required>
            <option value="">-- Forma de pago --</option>
            <option value="Efectivo">Efectivo</option>
            <option value="Tarjeta">Tarjeta</option>
            <option value="Transferencia">Transferencia</option>
          </select>

          <label for="id_usuario">ID Usuario</label>
          <input type="text" id="id_usuario" th:field="*{id_usuario}" required />

          <button type="submit" style="grid-column: 1 / -1;">üíæ Guardar Factura</button>
        </form>
      </div>

      <div class="card">
        <h3>üìã Lista de Facturas</h3>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>N√∫mero</th>
              <th>Emisi√≥n</th>
              <th>Vencimiento</th>
              <th>ID Cliente</th>
              <th>ID Venta</th>
              <th>Subtotal</th>
              <th>Impuestos</th>
              <th>Descuentos</th>
              <th>Total</th>
              <th>Estado</th>
              <th>Tipo</th>
              <th>Forma Pago</th>
              <th>ID Usuario</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="f : ${facturas}">
              <td th:text="${f.id_factura}"></td>
              <td th:text="${f.numero_factura}"></td>
              <td th:text="${f.fecha_emision}"></td>
              <td th:text="${f.fecha_vencimiento}"></td>
              <td th:text="${f.id_cliente}"></td>
              <td th:text="${f.id_venta}"></td>
              <td th:text="${f.subtotal}"></td>
              <td th:text="${f.impuestos}"></td>
              <td th:text="${f.descuentos}"></td>
              <td th:text="${f.total}"></td>
              <td th:text="${f.estado}"></td>
              <td th:text="${f.tipo_factura}"></td>
              <td th:text="${f.forma_pago}"></td>
              <td th:text="${f.id_usuario}"></td>
              <td>
                <a th:href="@{'/facturacion/editar/' + ${f.id_factura}}" class="btn-accion btn-editar">‚úèÔ∏è</a>
                <a th:href="@{'/facturacion/eliminar/' + ${f.id_factura}}" class="btn-accion btn-eliminar" onclick="return confirm('¬øSeguro que deseas eliminar esta factura?')">üóëÔ∏è</a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <script>
    function toggleFormulario(id) {
      document.getElementById(id).classList.toggle("hidden");
    }

    function mostrarSeccion(id, link) {
      document.querySelectorAll(".seccion").forEach((s) => s.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      document.querySelectorAll(".sidebar a").forEach((a) => a.classList.remove("active"));
      link.classList.add("active");
    }

    // C√°lculo autom√°tico de total en facturaci√≥n
    const subtotalInput = document.getElementById("subtotal");
    const impuestosInput = document.getElementById("impuestos");
    const descuentosInput = document.getElementById("descuentos");
    const totalInput = document.getElementById("total");

    function calcularTotal() {
      const subtotal = parseFloat(subtotalInput?.value) || 0;
      const impuestos = parseFloat(impuestosInput?.value) || 0;
      const descuentos = parseFloat(descuentosInput?.value) || 0;

      const total = subtotal + subtotal * (impuestos / 100) - subtotal * (descuentos / 100);
      if (totalInput) totalInput.value = total.toFixed(2);
    }

    [subtotalInput, impuestosInput, descuentosInput].forEach((input) => {
      input?.addEventListener("input", calcularTotal);
    });
  </script>
</body>
</html>
