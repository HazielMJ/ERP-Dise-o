<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Módulo de Nómina - Sistema ERP</title>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <link rel="stylesheet" th:href="@{/css/Finanzas.css}">

  <script>
    function verDetalleNomina(id, emp, asiento, periodo, inicio, fin, pago, dias, salario, perc, dedu, neto, tipo, estado, obs) {
      document.getElementById('d_id_nomina').value = id;
      document.getElementById('d_id_empleado').value = emp;
      document.getElementById('d_id_asiento').value = asiento;
      document.getElementById('d_periodo').value = periodo;
      document.getElementById('d_inicio').value = inicio;
      document.getElementById('d_fin').value = fin;
      document.getElementById('d_pago').value = pago;
      document.getElementById('d_dias').value = dias;
      document.getElementById('d_salario').value = salario;
      document.getElementById('d_perc').value = perc;
      document.getElementById('d_dedu').value = dedu;
      document.getElementById('d_neto').value = neto;
      document.getElementById('d_tipo').value = tipo;
      document.getElementById('d_estado').value = estado;
      document.getElementById('d_obs').value = obs;

      document.getElementById('modalDetalleNominaFull').classList.add('active');
    }

    let tabActual = 'nomina';
    function cambiarTab(nombreTab) {
      tabActual = nombreTab;

      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === nombreTab);
      });

      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.toggle('active', content.id === `tab-${nombreTab}`);
      });

      const btnAccion = document.getElementById('btnAccionPrincipal');
      if (!btnAccion) return;

      if (nombreTab === 'nomina') {
        btnAccion.innerHTML = '<i class="fas fa-plus"></i> Nueva Nómina';
        btnAccion.onclick = abrirModalNuevaNomina;
      } else if (nombreTab === 'detalle') {
        btnAccion.innerHTML = '<i class="fas fa-plus"></i> Nuevo Concepto';
        btnAccion.onclick = abrirModalDetalleNomina;
      }
    }

    function actualizarKPIs() {
      const filas = document.querySelectorAll('#nominaTableBody tr[data-estado]');
      let pagadas = 0;
      let pendientes = 0;

      filas.forEach(tr => {
        const estado = tr.getAttribute('data-estado');
        if (estado === 'PAGADA') pagadas++;
        else if (estado === 'PENDIENTE') pendientes++;
      });

      const elPagadas = document.getElementById('nominasPagadas');
      const elPendientes = document.getElementById('nominasPendientes');
      if (elPagadas) elPagadas.textContent = pagadas;
      if (elPendientes) elPendientes.textContent = pendientes;
    }

    function filtrarNominas() {
      const searchInput = document.getElementById('searchNomina');
      const estadoSelect = document.getElementById('estadoFilterNomina');
      if (!searchInput || !estadoSelect) return;

      const q = (searchInput.value || '').toLowerCase();
      const estado = estadoSelect.value;
      const filas = document.querySelectorAll('#nominaTableBody tr');

      filas.forEach(tr => {
        const texto = tr.innerText.toLowerCase();
        const estadoAttr = tr.getAttribute('data-estado') || '';

        const coincideTexto = texto.includes(q);
        const coincideEstado = !estado || estadoAttr === estado;

        tr.style.display = (coincideTexto && coincideEstado) ? '' : 'none';
      });
    }

    function calcularNomina() {
      const diasInput = document.getElementById('dias_trabajados');
      const salarioInput = document.getElementById('salario_diario');
      const totalPercepcionesInput = document.getElementById('total_percepciones');
      const totalDeduccionesInput = document.getElementById('total_deducciones');
      const totalNetoInput = document.getElementById('total_neto');

      if (!diasInput || !salarioInput || !totalPercepcionesInput || !totalDeduccionesInput || !totalNetoInput) return;

      const dias = parseFloat(diasInput.value) || 0;
      const salario = parseFloat(salarioInput.value) || 0;

      const percepciones = dias * salario;
      totalPercepcionesInput.value = percepciones.toFixed(2);

      const deducciones = percepciones * 0.10; 
      totalDeduccionesInput.value = deducciones.toFixed(2);

      const neto = percepciones - deducciones;
      totalNetoInput.value = neto.toFixed(2);
    }

    function abrirModalNuevaNomina() {
      document.getElementById('modalNominaTitle').innerHTML = '<i class="fas fa-plus-circle"></i> Nueva Nómina';
      document.getElementById('modalNomina').classList.add('active');
    }
    function abrirModalDetalleNomina() {
      document.getElementById('modalDetalleTitle').innerHTML = '<i class="fas fa-plus-circle"></i> Nuevo Concepto';
      document.getElementById('modalDetalle').classList.add('active');
    }
    function cerrarModal(id) {
      const modal = document.getElementById(id);
      if (modal) modal.classList.remove('active');
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    document.addEventListener('DOMContentLoaded', () => {
      cambiarTab('nomina');

      const searchInput = document.getElementById('searchNomina');
      const estadoSelect = document.getElementById('estadoFilterNomina');
      if (searchInput) searchInput.addEventListener('input', filtrarNominas);
      if (estadoSelect) estadoSelect.addEventListener('change', filtrarNominas);

      const calcInputs = ['dias_trabajados', 'salario_diario'];
      calcInputs.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', calcularNomina);
      });
      actualizarKPIs();
    });
    function abrirDetalleDesdeData(btn) {

  document.getElementById("d_id_nomina").value = btn.dataset.id;
  document.getElementById("d_id_empleado").value = btn.dataset.emp;
  document.getElementById("d_id_asiento").value = btn.dataset.asiento;
  document.getElementById("d_periodo").value = btn.dataset.periodo;
  document.getElementById("d_inicio").value = btn.dataset.inicio;
  document.getElementById("d_fin").value = btn.dataset.fin;
  document.getElementById("d_pago").value = btn.dataset.pago;
  document.getElementById("d_dias").value = btn.dataset.dias;
  document.getElementById("d_salario").value = btn.dataset.salario;
  document.getElementById("d_perc").value = btn.dataset.perc;
  document.getElementById("d_dedu").value = btn.dataset.dedu;
  document.getElementById("d_neto").value = btn.dataset.neto;
  document.getElementById("d_tipo").value = btn.dataset.tipo;
  document.getElementById("d_estado").value = btn.dataset.estado;
  document.getElementById("d_obs").value = btn.dataset.obs;

  document.getElementById("modalDetalleNominaFull").classList.add("active");
}

  </script>
</head>
<body>
  <div class="main-container">

    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2><i class="fas fa-chart-line"></i> ERP System</h2>
        <p>Sistema Integral de Gestión</p>
      </div>

      <ul class="nav-menu">
        <li class="nav-section"><div class="nav-section-title">PRINCIPAL</div></li>
        <li class="nav-item">
          <a href="/dashboard" class="nav-link"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        </li>
<li class="nav-section"><div class="nav-section-title">Finanzas</div></li>
        <li class="nav-item">
          <a href="/contabilidad" class="nav-link">
            <i class="fas fa-calculator"></i><span>Contabilidad</span>
          </a>
        </li>
              <li class="nav-item">
          <a href="/impuesto" class="nav-link">
            <i class="fas fa-percent"></i><span>Impuestos</span>
          </a>
        </li>
          <li class="nav-item">
          <a href="/nomina" class="nav-link active"><i class="fas fa-money-bill-wave"></i><span>Nómina</span></a>
        </li>

        <li class="nav-section"><div class="nav-section-title">ADMINISTRACIÓN</div></li>
        <li class="nav-item">
          <a href="/usuarios" class="nav-link"><i class="fas fa-user-shield"></i><span>Usuarios</span></a>
        </li>
        <li class="nav-section"><div class="nav-section-title">VENTAS</div></li>
        <li class="nav-item">
          <a href="/clientes" class="nav-link"><i class="fas fa-users"></i><span>Clientes</span></a>
        </li>
        <li class="nav-item">
          <a href="/ventas" class="nav-link"><i class="fas fa-shopping-cart"></i><span>Ventas</span></a>
        </li>
        <li class="nav-item">
          <a href="/factura" class="nav-link"><i class="fas fa-file-invoice"></i><span>Facturación</span></a>
        </li>
        <li class="nav-item">
          <a href="/punto-venta" class="nav-link"><i class="fas fa-cash-register"></i><span>Punto de Venta</span></a>
        </li>

        <li class="nav-section"><div class="nav-section-title">COMPRAS</div></li>
        <li class="nav-item">
          <a href="/proveedores" class="nav-link"><i class="fas fa-truck"></i><span>Proveedores</span></a>
        </li>
        <li class="nav-item">
          <a href="/compras" class="nav-link"><i class="fas fa-shopping-bag"></i><span>Compras</span></a>
        </li>

        <li class="nav-section"><div class="nav-section-title">INVENTARIO</div></li>
        <li class="nav-item">
          <a href="/inventario" class="nav-link"><i class="fas fa-boxes"></i><span>Inventario</span></a>
        </li>
        <li class="nav-item">
          <a href="/almacenes" class="nav-link"><i class="fas fa-warehouse"></i><span>Almacenes</span></a>
        </li>

        <li class="nav-section"><div class="nav-section-title">RECURSOS HUMANOS</div></li>
        <li class="nav-item">
          <a href="/rrhh" class="nav-link"><i class="fas fa-user-tie"></i><span>Empleados</span></a>
        </li>
        <li class="nav-section"><div class="nav-section-title">ANÁLISIS</div></li>
        <li class="nav-item">
          <a href="/reportes" class="nav-link"><i class="fas fa-chart-bar"></i><span>Reportes</span></a>
        </li>

        <li class="nav-section"><div class="nav-section-title">SISTEMA</div></li>
        <li class="nav-item">
          <a href="/configuracion" class="nav-link"><i class="fas fa-cog"></i><span>Configuración</span></a>
        </li>
      </ul>

      <div class="logout-section">
        <button class="btn-logout"><i class="fas fa-sign-out-alt"></i><span>Cerrar Sesión</span></button>
      </div>
    </aside>

    <div class="main-content">

      <header class="page-header">
        <div class="header-left">
          <button class="mobile-menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
          <div>
            <h1><i class="fas fa-money-bill-wave"></i> Módulo de Nómina</h1>
            <div class="breadcrumb">
              <a href="/dashboard"><i class="fas fa-home"></i> Inicio</a>
              <span>/</span>
              <span>Nómina</span>
            </div>
          </div>
        </div>
        <div class="header-right">
          <button class="btn btn-primary" id="btnAccionPrincipal">
            <i class="fas fa-plus"></i> Nueva Nómina
          </button>
        </div>
      </header>

      <div class="tabs-container">
        <div class="tabs-nav">
          <button class="tab-button active" onclick="cambiarTab('nomina')" data-tab="nomina">
            <i class="fas fa-money-bill"></i><span>Nómina</span>
          </button>
          <button class="tab-button" onclick="cambiarTab('detalle')" data-tab="detalle">
            <i class="fas fa-list"></i><span>Detalle Nómina</span>
          </button>
        </div>
      </div>

      <div class="tab-content active" id="tab-nomina">
        <section class="content-section">

          <div class="stats-grid">
            <div class="stat-card" style="border-left-color: var(--azul-principal)">
              <div class="stat-header">
                <div class="stat-icon" style="background: linear-gradient(135deg,var(--azul-principal),var(--azul-secundario));">
                  <i class="fas fa-users"></i>
                </div>
              </div>
              <div class="stat-value" th:text="${#lists.size(nominas)}">0</div>
              <div class="stat-label">Nóminas registradas</div>
            </div>

            <div class="stat-card" style="border-left-color: var(--verde-exito)">
              <div class="stat-header">
                <div class="stat-icon" style="background: linear-gradient(135deg,var(--verde-exito),var(--verde-exito-gradient));">
                  <i class="fas fa-check-circle"></i>
                </div>
              </div>
              <div class="stat-value" id="nominasPagadas">0</div>
              <div class="stat-label">Pagadas (vista)</div>
            </div>

            <div class="stat-card" style="border-left-color: var(--amarillo-advertencia)">
              <div class="stat-header">
                <div class="stat-icon" style="background: linear-gradient(135deg,var(--amarillo-advertencia),var(--amarillo-advertencia-dark));">
                  <i class="fas fa-clock"></i>
                </div>
              </div>
              <div class="stat-value" id="nominasPendientes">0</div>
              <div class="stat-label">Pendientes (vista)</div>
            </div>
          </div>

          <div class="toolbar">
            <div class="search-box">
              <i class="fas fa-search input-icon"></i>
              <input type="text" id="searchNomina" class="search-input" placeholder="Buscar por periodo, empleado, tipo..." />
            </div>
            <div class="toolbar-actions">
              <select class="filter-select" id="estadoFilterNomina">
                <option value="">Todos los estados</option>
                <option value="PENDIENTE">Pendiente</option>
                <option value="PAGADA">Pagada</option>
                <option value="ANULADA">Anulada</option>
              </select>
              <a class="btn btn-secondary" th:href="@{/nomina}">
                <i class="fas fa-sync-alt"></i> Actualizar
              </a>
              <button class="btn btn-primary" type="button" onclick="abrirModalNuevaNomina()">
                <i class="fas fa-plus"></i> Nueva Nómina
              </button>
            </div>
          </div>
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title"><i class="fas fa-list"></i> Listado de Nómina</h3>
            </div>
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Empleado</th>
                  <th>Periodo</th>
                  <th>Pago</th>
                  <th>Neto</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>

              <tbody id="nominaTableBody">
                <tr th:if="${#lists.isEmpty(nominas)}">
                  <td colspan="7" class="empty-state">
                    <i class="fas fa-money-bill"></i>
                    <h3>No hay nóminas registradas</h3>
                    <p>Comienza creando tu primera nómina</p>
                  </td>
                </tr>

                <tr th:each="n : ${nominas}" th:attr="data-estado=${n.estado}">
                  <td th:text="${n.id_nomina}"></td>
                  <td th:text="${n.id_empleado}"></td>
                  <td th:text="${n.periodo_nomina}"></td>
                  <td th:text="${#dates.format(n.fecha_pago, 'yyyy-MM-dd')}"></td>
                  <td th:text="${n.total_neto}"></td>
                  <td th:text="${n.estado}" data-col="estado"></td>
                  <td>
                    <button class="btn btn-icon btn-info"
        type="button"
        th:attr="
            data-id=${n.id_nomina},
            data-emp=${n.id_empleado},
            data-asiento=${n.id_asiento_contable},
            data-periodo=${n.periodo_nomina},
            data-inicio=${#dates.format(n.fecha_inicio,'yyyy-MM-dd')},
            data-fin=${#dates.format(n.fecha_fin,'yyyy-MM-dd')},
            data-pago=${#dates.format(n.fecha_pago,'yyyy-MM-dd')},
            data-dias=${n.dias_trabajados},
            data-salario=${n.salario_diario},
            data-perc=${n.total_percepciones},
            data-dedu=${n.total_deducciones},
            data-neto=${n.total_neto},
            data-tipo=${n.tipo_nomina},
            data-estado=${n.estado},
            data-obs='Sin observaciones'
        "
        onclick="abrirDetalleDesdeData(this)">
  <i class="fas fa-eye"></i>
</button>


                    <a class="btn btn-icon btn-danger"
                       th:href="@{'/nomina/eliminar/' + ${n.id_nomina}}"
                       title="Eliminar">
                      <i class="fas fa-trash"></i>
                    </a>
                  </td>
                </tr>
              </tbody>

            </table>
          </div>
        </section>
      </div>
      <div class="tab-content" id="tab-detalle">
        <section class="content-section">
<div class="stats-grid" style="margin-bottom: 25px;">

  <div class="stat-card" style="border-left-color: var(--azul-principal);">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, var(--azul-principal), var(--azul-secundario));">
        <i class="fas fa-list"></i>
      </div>
    </div>
    <div class="stat-value" th:text="${#lists.size(detallenomina)}">0</div>
    <div class="stat-label">Conceptos Registrados</div>
  </div>

  <div class="stat-card" style="border-left-color: var(--verde-exito);">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, var(--verde-exito), var(--verde-exito-gradient));">
        <i class="fas fa-arrow-up"></i>
      </div>
    </div>
    <div class="stat-value" id="kpiDetallePercepciones">0.00</div>
    <div class="stat-label">Total Percepciones</div>
  </div>

  <div class="stat-card" style="border-left-color: var(--amarillo-advertencia);">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, var(--amarillo-advertencia), var(--amarillo-advertencia-dark));">
        <i class="fas fa-arrow-down"></i>
      </div>
    </div>
    <div class="stat-value" id="kpiDetalleDeducciones">0.00</div>
    <div class="stat-label">Total Deducciones</div>
  </div>

  <div class="stat-card" style="border-left-color: var(--rojo-error);">
    <div class="stat-header">
      <div class="stat-icon" style="background: linear-gradient(135deg, var(--rojo-error), #ff6b6b);">
        <i class="fas fa-wallet"></i>
      </div>
    </div>
    <div class="stat-value" id="kpiDetalleNeto">0.00</div>
    <div class="stat-label">Neto Total</div>
  </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const filas = document.querySelectorAll("#detalleTableBody tr[th\\:each], #detalleTableBody tr[data-row]");

  let percepciones = 0;
  let deducciones = 0;

  filas.forEach(tr => {
    const tipo = tr.children[2]?.innerText?.trim() || "";
    const monto = parseFloat(tr.children[5]?.innerText || 0);

    if (tipo === "PERCEPCION") percepciones += monto;
    if (tipo === "DEDUCCION") deducciones += monto;
  });

  const neto = percepciones - deducciones;

  document.getElementById("kpiDetallePercepciones").textContent = percepciones.toFixed(2);
  document.getElementById("kpiDetalleDeducciones").textContent = deducciones.toFixed(2);
  document.getElementById("kpiDetalleNeto").textContent = neto.toFixed(2);
});
</script>

          <div class="toolbar">
            <div class="search-box">
              <i class="fas fa-search input-icon"></i>
              <input type="text" id="searchDetalle" class="search-input" placeholder="Buscar por concepto, tipo..." oninput="
                const q=(this.value||'').toLowerCase();
                document.querySelectorAll('#detalleTableBody tr').forEach(tr=>{
                  tr.style.display = tr.innerText.toLowerCase().includes(q)?'':'none';
                });
              "/>
            </div>
            <div class="toolbar-actions">
              <a class="btn btn-secondary" th:href="@{/detallenomina}">
                <i class="fas fa-sync-alt"></i> Actualizar
              </a>
              <button class="btn btn-primary" type="button" onclick="abrirModalDetalleNomina()">
                <i class="fas fa-plus"></i> Nuevo Concepto
              </button>
            </div>
          </div>

          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title"><i class="fas fa-list"></i> Detalle de Nómina</h3>
            </div>
            <table class="table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>ID Nómina</th>
                  <th>Tipo</th>
                  <th>Concepto</th>
                  <th>Clave SAT</th>
                  <th>Monto</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="detalleTableBody">
                <tr th:if="${#lists.isEmpty(detallenomina)}">
                  <td colspan="7" class="empty-state">
                    <i class="fas fa-list"></i>
                    <h3>No hay conceptos registrados</h3>
                    <p>Agrega tu primer concepto de nómina</p>
                  </td>
                </tr>

                <tr th:each="d : ${detallenomina}">
                  <td th:text="${d.id_detalle_nomina}"></td>
                  <td th:text="${d.id_nomina}"></td>
                  <td th:text="${d.tipo}"></td>
                  <td th:text="${d.concepto}"></td>
                  <td th:text="${d.clave_sat}"></td>
                  <td th:text="${d.monto}"></td>
                  <td>
                    <a class="btn btn-icon btn-danger" th:href="@{'/detallenomina/eliminar/' + ${d.id_detalle_nomina}}" title="Eliminar">
                      <i class="fas fa-trash"></i>
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
      </div>

    </div>
  </div>

  <div class="modal" id="modalNomina">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalNominaTitle">
          <i class="fas fa-plus-circle"></i> Nueva Nómina
        </h3>
        <button class="modal-close" onclick="cerrarModal('modalNomina')"><i class="fas fa-times"></i></button>
      </div>

      <div class="modal-body">
        <form th:action="@{/nomina/guardar}" method="post" id="formNomina" oninput="calcularNomina()">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">ID Empleado <span class="required">*</span></label>
              <input type="number" class="form-input" name="id_empleado" required>
            </div>

            <div class="form-group">
              <label class="form-label">ID Asiento Contable <span class="required">*</span></label>
              <input type="number" class="form-input" name="id_asiento_contable" required>
            </div>

            <div class="form-group">
              <label class="form-label">Periodo Nómina <span class="required">*</span></label>
              <input type="text" class="form-input" name="periodo_nomina" placeholder="YYYY-MM" required>
            </div>

            <div class="form-group">
              <label class="form-label">Fecha Inicio <span class="required">*</span></label>
              <input type="date" class="form-input" name="fecha_inicio" required>
            </div>

            <div class="form-group">
              <label class="form-label">Fecha Fin <span class="required">*</span></label>
              <input type="date" class="form-input" name="fecha_fin" required>
            </div>

            <div class="form-group">
              <label class="form-label">Fecha Pago <span class="required">*</span></label>
              <input type="date" class="form-input" name="fecha_pago" required>
            </div>

            <div class="form-group">
              <label class="form-label">Días Trabajados <span class="required">*</span></label>
              <input type="number" class="form-input" name="dias_trabajados" id="dias_trabajados" required>
            </div>

            <div class="form-group">
              <label class="form-label">Salario Diario <span class="required">*</span></label>
              <input type="number" step="0.01" class="form-input" name="salario_diario" id="salario_diario" required>
            </div>

            <div class="form-group">
              <label class="form-label">Total Percepciones</label>
              <input type="number" step="0.01" class="form-input" name="total_percepciones" id="total_percepciones" readonly>
            </div>

            <div class="form-group">
              <label class="form-label">Total Deducciones</label>
              <input type="number" step="0.01" class="form-input" name="total_deducciones" id="total_deducciones" readonly>
            </div>

            <div class="form-group">
              <label class="form-label">Total Neto</label>
              <input type="number" step="0.01" class="form-input" name="total_neto" id="total_neto" readonly>
            </div>

            <div class="form-group">
              <label class="form-label">Tipo Nómina <span class="required">*</span></label>
              <select class="form-select" name="tipo_nomina" required>
                <option value="Mensual">Mensual</option>
                <option value="Quincenal">Quincenal</option>
                <option value="Semanal">Semanal</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Estado <span class="required">*</span></label>
              <select class="form-select" name="estado" required>
                <option value="PENDIENTE">PENDIENTE</option>
                <option value="PAGADA">PAGADA</option>
                <option value="ANULADA">ANULADA</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label class="form-label">Observaciones</label>
              <textarea class="form-textarea" name="observaciones" placeholder="Notas internas (opcional)"></textarea>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalNomina')"><i class="fas fa-times"></i> Cancelar</button>
        <button type="submit" class="btn btn-primary" form="formNomina"><i class="fas fa-save"></i> Guardar Nómina</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalDetalle">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3 class="modal-title" id="modalDetalleTitle">
          <i class="fas fa-plus-circle"></i> Nuevo Concepto
        </h3>
        <button class="modal-close" onclick="cerrarModal('modalDetalle')"><i class="fas fa-times"></i></button>
      </div>

      <div class="modal-body">
        <form th:action="@{/detallenomina/guardar}" method="post" id="formDetalle">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">ID Nómina <span class="required">*</span></label>
              <input type="number" class="form-input" name="id_nomina" required>
            </div>

            <div class="form-group">
              <label class="form-label">Tipo <span class="required">*</span></label>
              <select class="form-select" name="tipo" required>
                <option value="PERCEPCION">Percepción</option>
                <option value="DEDUCCION">Deducción</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Concepto <span class="required">*</span></label>
              <input type="text" class="form-input" name="concepto" required>
            </div>

            <div class="form-group">
              <label class="form-label">Clave SAT</label>
              <input type="text" class="form-input" name="clave_sat" maxlength="10">
            </div>

            <div class="form-group">
              <label class="form-label">Monto <span class="required">*</span></label>
              <input type="number" step="0.01" class="form-input" name="monto" required>
            </div>

            <div class="form-group full-width">
              <label class="form-label">Notas</label>
              <textarea class="form-textarea" name="notas" placeholder="Opcional"></textarea>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalDetalle')"><i class="fas fa-times"></i> Cancelar</button>
        <button type="submit" class="btn btn-primary" form="formDetalle"><i class="fas fa-save"></i> Guardar Concepto</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalDetalleNominaFull">
    <div class="modal-content" style="max-width: 950px;">
      <div class="modal-header">
        <h3 class="modal-title">
          <i class="fas fa-file-invoice"></i> Detalles de la Nómina
        </h3>
        <button class="modal-close" onclick="cerrarModal('modalDetalleNominaFull')">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="form-grid">

          <div class="form-group">
            <label>ID Nómina</label>
            <input id="d_id_nomina" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>ID Empleado</label>
            <input id="d_id_empleado" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>ID Asiento C.</label>
            <input id="d_id_asiento" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>Periodo</label>
            <input id="d_periodo" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>Fecha Inicio</label>
            <input id="d_inicio" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>Fecha Fin</label>
            <input id="d_fin" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>Fecha Pago</label>
            <input id="d_pago" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>Días Trabajados</label>
            <input id="d_dias" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>Salario Diario</label>
            <input id="d_salario" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>Percepciones</label>
            <input id="d_perc" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>Deducciones</label>
            <input id="d_dedu" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>Neto</label>
            <input id="d_neto" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>Tipo Nómina</label>
            <input id="d_tipo" class="form-input" readonly>
          </div>

          <div class="form-group">
            <label>Estado</label>
            <input id="d_estado" class="form-input" readonly>
          </div>

          <div class="form-group full-width">
            <label>Observaciones</label>
            <textarea id="d_obs" class="form-textarea" readonly></textarea>
          </div>

        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="cerrarModal('modalDetalleNominaFull')">
          <i class="fas fa-times"></i> Cerrar
        </button>
      </div>
    </div>
  </div>

</body>
</html>


